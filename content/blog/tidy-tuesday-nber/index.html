---
title: "Explorando os dados dos artigos da NBER #TidyTuesday"
author: Fernanda Fiel Peres
date: '2021-09-20'
slug: [probabilidade-positivo-verdadeiro]
categories: ['TidyTuesday', 'Gráficos']
tags: ['tidytuesday', 'ggplot2']
comments: yes
summary: 'Analisando os dados das publicações no NBER nas últimas décadas, com foco no gênero dos autores e co-autores. Essa análise de dados faz parte do projeto #TidyTuesday.'
output:
  blogdown::html_page:
    toc: false
---

<link href="{{< blogdown/postref >}}index_files/tabwid/tabwid.css" rel="stylesheet" />


<div id="os-dados-analisados" class="section level3">
<h3>Os dados analisados</h3>
<p>O post de hoje explora os dados dos artigos publicados pela National Bureau of Economic Research (NBER), que fazem parte da semana 40 do projeto <a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday</a>. Os dados estão disponíveis no <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-09-28/readme.md">repositório oficial do projeto</a>.</p>
<blockquote>
<p>National Bureau of Economic Research (NBER) é uma organização sem fins lucrativos norte-americana voltada para pesquisa e “comprometida em realizar e disseminar pesquisas econômicas imparciais entre formuladores de políticas públicas, profissionais de negócios e a comunidade acadêmica”.<br />
Fonte: <a href="https://pt.wikipedia.org/wiki/National_Bureau_of_Economic_Research">Wikipedia</a></p>
</blockquote>
<p>Essa é a minha segunda participação no #TidyTuesday e tem sido super proveitoso participar, porque acabo aprendendo novas funções de pacotes que eu uso e amo, como o <code>dplyr</code> e o <code>ggplot2</code>, e também acabo explorando outros pacotes. Essa semana, além do <code>ggtext</code> que eu conheci semana passada, também usei o pacote <code>gender</code>, que há um tempo eu tinha vontade de usar, mas ainda não tinha tido coragem de explorar.<br />
Ah, se você não sabe o que é a #TidyTuesday, eu explico melhor no meu <a href="https://fernandafperes.com.br/tidytuesday-emmy/">post anterior</a>.</p>
</div>
<div id="leitura-do-banco-de-dados-e-carregamento-dos-pacotes" class="section level3">
<h3>Leitura do banco de dados e carregamento dos pacotes</h3>
<p>Como comentei, eu usei os pacotes <code>gender</code>, <code>ggtext</code> e o <code>tidyverse</code>. No primeiro uso do pacote <code>gender</code> também é necessário instalar o <code>genderdata</code>, que eu só consegui instalar usando o código comentado abaixo - por alguma razão, não instalou automaticamente no meu computador.</p>
<pre class="r"><code>pacman::p_load(tidyverse, ggtext, gender)
# devtools::install_github(&quot;ropensci/genderdata&quot;)</code></pre>
<p>Para ler o banco de dados, usei o código fornecido no repositório do #TiduTuesday, que une vários bancos diferentes com a função <code>left_join</code>:</p>
<pre class="r"><code>papers &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-28/papers.csv&#39;)
authors &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-28/authors.csv&#39;)
programs &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-28/programs.csv&#39;)
paper_authors &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-28/paper_authors.csv&#39;)
paper_programs &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-28/paper_programs.csv&#39;)


joined_df &lt;- left_join(papers, paper_authors) %&gt;% 
  left_join(authors) %&gt;% 
  left_join(paper_programs) %&gt;% 
  left_join(programs)%&gt;% 
  mutate(
    catalogue_group = str_sub(paper, 1, 1),
    catalogue_group = case_when(
      catalogue_group == &quot;h&quot; ~ &quot;Historical&quot;,
      catalogue_group == &quot;t&quot; ~ &quot;Technical&quot;,
      catalogue_group == &quot;w&quot; ~ &quot;General&quot;
    ),
    .after = paper
  )</code></pre>
<pre class="r"><code>sample_n(joined_df, 10)</code></pre>
<pre><code>## # A tibble: 10 × 12
##    paper  catalogue_group  year month title    author name  user_nber user_repec
##    &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     
##  1 w26855 General          2020     3 Redrawi… w1884… Matt… matteo_m… pma2176   
##  2 w13175 General          2007     6 Diffusi… w1206… Albe… albert_l… pli226    
##  3 w14504 General          2008    11 Sacred … w1442… Mere… meredith… &lt;NA&gt;      
##  4 w8099  General          2001     1 Relativ… w1910… Angu… angus_de… pde30     
##  5 w25083 General          2018     9 Macropr… w7267… Kris… kristin_… pfo1      
##  6 w19433 General          2013     9 Privacy… w1943… Katr… katrina_… &lt;NA&gt;      
##  7 w12180 General          2006     5 Peer Ef… w1218… Andr… andreas_… &lt;NA&gt;      
##  8 w5591  General          1996     5 Public … w2418… Davi… david_cu… pcu64     
##  9 w28613 General          2021     3 Financi… w9959… Hann… hanno_lu… plu17     
## 10 w12429 General          2006     8 Health … w4221… Alan… alan_mon… &lt;NA&gt;      
## # … with 3 more variables: program &lt;chr&gt;, program_desc &lt;chr&gt;,
## #   program_category &lt;chr&gt;</code></pre>
<p>O banco incluí uma lista de artigos da NBER acompanhados da data de publicação, nome dos autores e programa ao qual o artigo pertence. O banco inclui artigos do período de 1973 a 2021.</p>
</div>
<div id="identificando-o-gênero-dos-autores" class="section level3">
<h3>Identificando o gênero dos autores</h3>
<p>Há um tempo eu ouço falar no pacote <code>gender</code>, mas nunca o havia utilizado. Esse pacote permite identificar o gênero da pessoa com base no primeiro nome e no seu ano de nascimento. Por exemplo, de todos as pessoas chamadas Steve que nasceram em 1983, 99,4% eram homens e 0,6% eram mulheres. Logo, o pacote classificará um Steve nascido nesse ano como alguém do gênero masculino.<br />
Vale dizer que é um pacote que usa um banco de dados com nomes em inglês, então seu funcionamento é limitado esse tipo de dado. Para os autores dos artigos da NBER, o pacote foi capaz de identificar o gênero de mais de 80% dos autores, então segui com a análise.<br />
As análises que eu conduzi aqui foram baseadas no artigo <a href="https://bldavies.com/blog/female-representation-collaboration-nber/">Female representation and collaboration at the NBER</a>, escrito por Ben Davies. Eu tentei criar meu próprio script, sem “colar” do dele para me desafiar (e porque, para ser honesta, eu demorei para perceber que o post tinha um link para o script, haha!). Mas, eventualmente, o <a href="https://github.com/bldavies/bldavies.com/tree/master/content/blog/2021-03-29-female-representation-collaboration-nber/">script do Ben Davies</a> foi consultado.</p>
<p>O meu primeiro passo foi criar duas colunas: uma coluna com o primeiro nome de cada autor (coluna <code>first_name</code>) e uma coluna com a data de nascimento estimada para cada autor (coluna <code>birth_year</code>). Estimei como ano de nascimento a data de publicação do artigo menos 35 anos - uma estratégia que não é à prova de falhas, mas que eu considerei uma estimativa válida.</p>
<pre class="r"><code>joined_df$first_name &lt;- sapply(strsplit(joined_df$name, &quot; &quot;), `[`, 1)
joined_df$birth_year &lt;- joined_df$year - 35</code></pre>
<p>O próximo passo foi aplicar a função <code>gender_df</code> ao <em>data frame</em> para estimar os gêneros dos autores.</p>
<pre class="r"><code>df_gender &lt;- gender::gender_df(joined_df,
                               name_col = &quot;first_name&quot;,
                               year_col = &quot;birth_year&quot;,
                               method = &quot;ssa&quot;)</code></pre>
<pre><code>## Warning: The `.dots` argument of `group_by()` is deprecated as of dplyr 1.0.0.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p>Isso resultou no seguinte banco de dados:</p>
<pre class="r"><code>sample_n(df_gender, 10)</code></pre>
<pre><code>## # A tibble: 10 × 6
##    name        proportion_male proportion_female gender year_min year_max
##    &lt;chr&gt;                 &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 Robert                0.997            0.0029 male       1955     1955
##  2 Robert                0.992            0.0077 male       1984     1984
##  3 Andrew                0.996            0.0039 male       1964     1964
##  4 James                 0.993            0.007  male       1976     1976
##  5 Marc                  0.989            0.0111 male       1984     1984
##  6 Constantine           1                0      male       1985     1985
##  7 Richard               0.996            0.0036 male       1964     1964
##  8 Thomas                0.993            0.0069 male       1981     1981
##  9 Guido                 1                0      male       1964     1964
## 10 Douglas               0.994            0.0064 male       1975     1975</code></pre>
<p>O próximo passo foi unir o banco de dados com os artigos, o <code>joined_df</code>, ao banco com os gêneros, o <code>df_gender</code>. Para isso, eu inicialmente tive que filtrar o banco <code>df_gender</code> para incluir apenas os casos não repetidos de nome e ano de nascimento, além de renomear algumas colunas para possibilitar o <code>left_join</code>. Ao final, fiquei com um <em>data frame</em> chamado <code>df</code>.</p>
<pre class="r"><code>df_gender &lt;- df_gender %&gt;% rename(first_name = name,
                                  birth_year = year_min) %&gt;%
  select(first_name, birth_year, gender) %&gt;% distinct()

df &lt;- left_join(joined_df, df_gender)</code></pre>
<pre><code>## Joining, by = c(&quot;first_name&quot;, &quot;birth_year&quot;)</code></pre>
<pre class="r"><code>sample_n(df, 10)</code></pre>
<pre><code>## # A tibble: 10 × 15
##    paper  catalogue_group  year month title    author name  user_nber user_repec
##    &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     
##  1 w18866 General          2013     3 On Retu… w1234… Char… charles_… pth302    
##  2 w21656 General          2015    10 Do Stud… w5750… Dahl… dahlia_r… &lt;NA&gt;      
##  3 w6042  General          1997     5 The Fut… w5216… Toma… tomas_ph… pph37     
##  4 w23018 General          2017     1 Proximi… w7994… Juli… julia_la… pla36     
##  5 w22637 General          2016     9 Importi… w2104… Kave… kaveh     pma1731   
##  6 w22298 General          2016     6 Reverse… w1969… Luig… luigi_bo… pbo852    
##  7 w17390 General          2011     9 Cleanin… w8620… Chri… christop… pkn5      
##  8 w27229 General          2020     5 Were Ur… w1692… Jose… joseph_s… &lt;NA&gt;      
##  9 w13934 General          2008     4 Econome… w0034… Jame… james_he… phe22     
## 10 w24580 General          2018     5 Job Vac… w0143… Geor… george_b… pbo44     
## # … with 6 more variables: program &lt;chr&gt;, program_desc &lt;chr&gt;,
## #   program_category &lt;chr&gt;, first_name &lt;chr&gt;, birth_year &lt;dbl&gt;, gender &lt;chr&gt;</code></pre>
</div>
<div id="proporção-de-mulheres-autoras-ou-co-autoras-de-artigos-da-nber-por-década" class="section level3">
<h3>Proporção de mulheres autoras ou co-autoras de artigos da NBER por década</h3>
<p>O próximo passo foi criar uma variável que correspondesse à década de publicação do artigo, chamada de <code>decade</code>. Eu incluí as décadas de 1980 a 2010 em um objeto ( <code>decades</code>), para filtrar o banco posteriormente. Essas décadas foram escolhidas por serem as com dados completos, referentes aos 10 anos.</p>
<pre class="r"><code>df &lt;- df %&gt;% mutate(decade = factor(paste0((floor(year / 10) * 10),&quot;s&quot;)))

decades &lt;- c(&quot;1980s&quot;, &quot;1990s&quot;, &quot;2000s&quot;, &quot;2010s&quot;)</code></pre>
<p>A tabela abaixo resume a proporção de mulheres autoras/ co-autoras por década, bem como a proporção de autores em cada década cujo gênero não pode ser identificado.</p>
<pre class="r"><code>tbl_sum &lt;- df %&gt;% filter(decade %in% decades) %&gt;%
  group_by(decade, gender) %&gt;% 
  count() %&gt;% 
  spread(gender, n) %&gt;% 
  rename(NI = &quot;&lt;NA&gt;&quot;) %&gt;% 
  mutate(total = female + male,
         prop.f = round(100*female/total,2),
         prop.m = round(100*male/total,2),
         estimated.sex = 100-round(100*NI/(female+male+NI),2))

tbl_cont &lt;- df %&gt;% filter(!is.na(gender),
                          decade %in% decades) %&gt;%
  group_by(decade, gender) %&gt;% 
  count()</code></pre>
<template id="cd0138d4-f120-4e05-840e-b1874a42a8ce"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-70717b6a{}.cl-706caea0{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-706cb7ba{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-706ccef8{width:100.8pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-706ccef9{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-706ccf02{width:100.8pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-706ccf0c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-706ccf0d{width:100.8pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-706ccf16{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-70717b6a'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-706ccf16"><p class="cl-706cb7ba"><span class="cl-706caea0">Década</span></p></td><td class="cl-706ccf0d"><p class="cl-706cb7ba"><span class="cl-706caea0">Autoras/ Co-autoras mulheres</span></p></td><td class="cl-706ccf0d"><p class="cl-706cb7ba"><span class="cl-706caea0">Autores/ Co-autores homens</span></p></td><td class="cl-706ccf0d"><p class="cl-706cb7ba"><span class="cl-706caea0">Proporção de autoras mulheres (%)</span></p></td><td class="cl-706ccf0d"><p class="cl-706cb7ba"><span class="cl-706caea0">Proporção de autores com gênero identificado (%)</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-706ccef9"><p class="cl-706cb7ba"><span class="cl-706caea0">1980s</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">401</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">4956</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">7,49</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">85,75</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-706ccef9"><p class="cl-706cb7ba"><span class="cl-706caea0">1990s</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">1380</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">8191</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">14,42</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">85,22</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-706ccef9"><p class="cl-706cb7ba"><span class="cl-706caea0">2000s</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">4877</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">20975</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">18,87</span></p></td><td class="cl-706ccef8"><p class="cl-706cb7ba"><span class="cl-706caea0">82,32</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-706ccf0c"><p class="cl-706cb7ba"><span class="cl-706caea0">2010s</span></p></td><td class="cl-706ccf02"><p class="cl-706cb7ba"><span class="cl-706caea0">10990</span></p></td><td class="cl-706ccf02"><p class="cl-706cb7ba"><span class="cl-706caea0">38964</span></p></td><td class="cl-706ccf02"><p class="cl-706cb7ba"><span class="cl-706caea0">22,00</span></p></td><td class="cl-706ccf02"><p class="cl-706cb7ba"><span class="cl-706caea0">80,00</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="3c29724d-ccb3-4432-89e0-54d5a67b8ef2"></div>
<script>
var dest = document.getElementById("3c29724d-ccb3-4432-89e0-54d5a67b8ef2");
var template = document.getElementById("cd0138d4-f120-4e05-840e-b1874a42a8ce");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>Então, eu optei por criar um gráfico de linhas para mostrar a evolução da quantidade de autores/ co-autores de ambos os gêneros ao longo das décadas. Além disso, incluí no gráfico um rótulo indicando a proporção de mulheres. Usei para isso a camada <code>geom_label</code>, que por alguma razão eu sempre evito, tanto que essa foi a primeira vez que usei essa camada na vida, haha.</p>
<pre class="r"><code>ggplot() +
  geom_line(data = tbl_cont,
            aes(x = decade, y = n,
                group = gender, color = gender),
            size = 1) +
  geom_label(data = tbl_sum, aes(x = decade, y = (female+2100),
                                 label = scales::number(prop.f,
                                                        decimal.mark = &quot;,&quot;,
                                                        suffix = &quot;%&quot;)),
             size = 2.8) +
  labs(x = &quot;Década&quot;, color = &quot;Gênero do autor&quot;,
       title = &quot;&lt;b style=&#39;color:#B8D8D8&#39;&gt;Homens&lt;/b&gt; e &lt;b style=&#39;color:#7A9E9F&#39;&gt;mulheres&lt;/b&gt; autores ou co-autores de&lt;br&gt;
       artigos da NBER por década&quot;,
       subtitle = &quot;A proporção de autoras/ co-autoras mulheres aumentou ao longo das décadas\nmas mulheres ainda representam menos de 25% dos autores/ co-autores&quot;) +
  scale_color_manual(values = c(&quot;#7A9E9F&quot;, &quot;#B8D8D8&quot;)) +
  theme_classic() +
  theme(axis.ticks = element_blank(),
        axis.line = element_blank(),
        panel.grid.major.y = element_line(color = &quot;grey90&quot;,
                                          size = 0.3),
        axis.title.y = element_blank(),
        legend.position = &quot;none&quot;,
        plot.title = element_markdown())</code></pre>
<p><img src="graf1.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
<div id="proporção-de-mulheres-autoras-ou-co-autoras-de-artigos-da-nber-por-programa-no-período-de-2000-a-2019" class="section level3">
<h3>Proporção de mulheres autoras ou co-autoras de artigos da NBER por programa, no período de 2000 a 2019</h3>
<p>Como próximo passo, eu tentei reproduzir o gráfico gerado pelo Ben Davies no artigo <a href="https://bldavies.com/blog/female-representation-collaboration-nber/">Female representation and collaboration at the NBER</a>, o qual representa a proporção de mulheres de acordo com o programa no qual o artigo foi publicado.<br />
Para isso, selecionei os 10 programas com mais publicações e agrupei os demais em “outros”. Calculei a proporção de mulheres em cada um desses programas, bem como a proporção de mulheres no geral. Ah, eu selecionei como período de interesse apenas as décadas de 2000 e 2010.</p>
<pre class="r"><code>top_20 &lt;- df %&gt;% filter(decade %in% c(&quot;2000s&quot;, &quot;2010s&quot;)) %&gt;% 
  mutate(program = factor(program)) %&gt;% 
  group_by(program) %&gt;% 
  summarise(n = n()) %&gt;% 
  arrange(-n) %&gt;%
  slice_max(n, n = 20) %&gt;% 
  pull(program)

df &lt;- df %&gt;% mutate(program_top = factor(case_when(program %in% top_20 ~ program,
                                                   TRUE ~ &quot;Other&quot;)))

df_prog &lt;- df %&gt;% filter(decade %in% c(&quot;2000s&quot;, &quot;2010s&quot;),
                         !is.na(gender), !is.na(program)) %&gt;%
  group_by(program, program_desc, program_category, gender) %&gt;% 
  count() %&gt;% 
  spread(gender, n) %&gt;%
  mutate(total = female + male,
         prop.f = round(100*female/total,2),
         program = factor(program))


prop.f.all &lt;- df %&gt;% filter(decade %in% c(&quot;2000s&quot;, &quot;2010s&quot;),
                            !is.na(gender), !is.na(program)) %&gt;%
  group_by(gender) %&gt;% 
  count() %&gt;% 
  spread(gender, n) %&gt;%
  mutate(total = female + male,
         prop.f = round(100*female/total,2)) %&gt;% 
  pull(prop.f)</code></pre>
<p>O gráfico, no final, ficou assim:</p>
<pre class="r"><code>ggplot(df_prog) +
  geom_bar(aes(x = fct_reorder(program,
                               prop.f),
               y = prop.f, fill = program_category), stat = &quot;identity&quot;) +
  geom_hline(yintercept = prop.f.all,
             color = &quot;grey50&quot;,
             lty = &quot;dashed&quot;) +
  geom_text(aes(label = program_desc, x = program, y = (prop.f/2)),
            size = 3) +
  scale_y_continuous(expand = expansion(add = c(0,3))) +
  scale_fill_manual(values = c(&quot;#7A9E9F&quot;, &quot;#C09BA2&quot;,&quot;#B8D8D8&quot;),
                    na.value = &quot;grey80&quot;) +
  labs(y = &quot;% de mulheres como autoras ou co-autoras&quot;,
       title = &quot;Proporção de autorias ou co-autorias de mulheres\nem artigos da NBER durante o período de 2000 a 2019&quot;,
       subtitle = &quot;A linha pontilhada indica essa proporção considerando-se todos os programas&quot;,
       fill = &quot;Categoria do programa&quot;) +
  coord_flip() +
  theme_classic() +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        axis.line.x = element_line(color = &quot;grey50&quot;, size = 0.3),
        axis.title.x = element_text(margin = margin(10,10,15,10)),
        legend.position = &quot;bottom&quot;,
        legend.title = element_text(size = 10)) +
  guides(fill = guide_legend(title.position = &quot;top&quot;, title.hjust = 0.5))</code></pre>
<p><img src="graf2.png" width="700px" style="display: block; margin: auto;" /></p>
<p><br><br><br></p>
</div>
